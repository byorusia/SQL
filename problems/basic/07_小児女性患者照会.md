# 小児女性患者照会

## 📖 問題文（日本語訳）

以下は総合病院に登録された患者情報を含む PATIENT テーブルです。

PATIENT テーブルから 12 歳以下の女性患者の患者名、患者番号、性別コード、年齢、電話番号を照会する SQL 文を作成してください。

この時、電話番号がない場合は 'NONE' で出力し、結果は年齢を基準に降順ソート、年齢が同じ場合は患者名を基準に昇順ソートしてください。

## 📊 テーブル構造

### PATIENT テーブル

PT_NO、PT_NAME、GEND_CD、AGE、TLNO は、それぞれ患者番号、患者名、性別コード、年齢、電話番号を意味します。

| Column name | Type        | Nullable |
| ----------- | ----------- | -------- |
| PT_NO       | VARCHAR(10) | FALSE    |
| PT_NAME     | VARCHAR(20) | FALSE    |
| GEND_CD     | VARCHAR(1)  | FALSE    |
| AGE         | INTEGER     | FALSE    |
| TLNO        | VARCHAR(50) | TRUE     |

**サンプルデータ:**

| PT_NO      | PT_NAME  | GEND_CD | AGE | TLNO        |
| ---------- | -------- | ------- | --- | ----------- |
| PT22000003 | ブラウン | M       | 18  | 01031246641 |
| PT22000004 | クロン   | M       | 7   | NULL        |
| PT22000006 | ポポ     | W       | 8   | NULL        |
| PT22000009 | ハンナ   | W       | 12  | 01032323117 |
| PT22000012 | プンプン | M       | 5   | NULL        |
| PT22000013 | クリス   | M       | 30  | 01059341192 |
| PT22000014 | トップ   | W       | 22  | 01039458213 |
| PT22000018 | アンナ   | W       | 11  | NULL        |
| PT22000019 | バラ     | W       | 10  | 01079068799 |
| PT22000021 | リロ     | W       | 33  | 01023290767 |

## 🎯 期待される出力

| PT_NAME | PT_NO      | GEND_CD | AGE | TLNO        |
| ------- | ---------- | ------- | --- | ----------- |
| ハンナ  | PT22000009 | W       | 12  | 01032323117 |
| アンナ  | PT22000018 | W       | 11  | NONE        |
| バラ    | PT22000019 | W       | 10  | 01079068799 |
| ポポ    | PT22000006 | W       | 8   | NONE        |

## 💡 解答

```sql
SELECT
    PT_NAME,
    PT_NO,
    GEND_CD,
    AGE,
    IFNULL(TLNO, 'NONE') AS TLNO
FROM PATIENT
WHERE AGE <= 12
    AND GEND_CD = 'W'
ORDER BY AGE DESC, PT_NAME ASC;
```

## 📝 解説

### アプローチ

1. PATIENT テーブルから必要なカラムを選択
2. WHERE 句で年齢 12 歳以下かつ性別コードが 'W'（女性）の条件を指定
3. IFNULL 関数で電話番号が NULL の場合は 'NONE' に変換
4. 年齢降順、患者名昇順でソート

### 解答の流れ

**12 歳以下の女性患者（GEND_CD = 'W' AND AGE <= 12）：**

- ハンナ（12 歳、電話番号あり）
- アンナ（11 歳、電話番号 NULL → NONE）
- バラ（10 歳、電話番号あり）
- ポポ（8 歳、電話番号 NULL → NONE）

**除外される患者：**

- 男性患者（GEND_CD = 'M'）：ブラウン、クロン、プンプン、クリス
- 12 歳超の女性患者：トップ（22 歳）、リロ（33 歳）

**ソート順：**

1. 年齢降順：12 → 11 → 10 → 8
2. 同じ年齢の場合は患者名昇順

### 学習ポイント

- **WHERE 句の複数条件**: AND 演算子で複数条件を組み合わせる
- **IFNULL 関数**: NULL 値を指定した値に置き換える
- **NULL 処理**: データベースでは NULL（値なし）の適切な処理が重要
- **複数カラムソート**: 優先順位をつけて複数条件でソート

### NULL 処理関数の種類

MySQL では以下の関数が使用可能です：

```sql
-- IFNULL（MySQL 専用、2 つの引数）
IFNULL(TLNO, 'NONE')

-- COALESCE（標準 SQL、複数の引数可能）
COALESCE(TLNO, 'NONE')

-- CASE 式（最も汎用的）
CASE WHEN TLNO IS NULL THEN 'NONE' ELSE TLNO END
```

IFNULL が最もシンプルで読みやすいため、この問題では IFNULL を使用しています。

### AND 条件の書き方

```sql
-- 推奨：各条件を改行して読みやすく
WHERE AGE <= 12
    AND GEND_CD = 'W'

-- 同じ意味（1 行で記述）
WHERE AGE <= 12 AND GEND_CD = 'W'
```

複数条件がある場合は改行して記述すると可読性が向上します。

## 🔑 キーワード

- SELECT（特定カラム）
- WHERE 句（複数条件）
- AND 演算子
- IFNULL 関数
- NULL 処理
- ORDER BY（複数カラム、昇順・降順混在）
